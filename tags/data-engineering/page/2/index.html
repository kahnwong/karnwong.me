<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>data engineering | Karn Wong</title><meta name=keywords content><meta name=description content="Homepage and blog by Karn Wong"><meta name=author content="Karn Wong"><link rel=canonical href=https://www.karnwong.me/tags/data-engineering/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><link rel=icon href=https://www.karnwong.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.karnwong.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.karnwong.me/favicon-32x32.png><link rel=apple-touch-icon href=https://www.karnwong.me/apple-touch-icon.png><link rel=mask-icon href=https://www.karnwong.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://www.karnwong.me/tags/data-engineering/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYMFC0KZ9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8CYMFC0KZ9",{anonymize_ip:!1})}</script><meta property="og:title" content="data engineering"><meta property="og:description" content="Homepage and blog by Karn Wong"><meta property="og:type" content="website"><meta property="og:url" content="https://www.karnwong.me/tags/data-engineering/"><meta name=twitter:card content="summary"><meta name=twitter:title content="data engineering"><meta name=twitter:description content="Homepage and blog by Karn Wong"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.karnwong.me/ accesskey=h title="Karn Wong (Alt + H)">Karn Wong</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.karnwong.me/about/ title=About><span>About</span></a></li><li><a href=https://www.karnwong.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://www.karnwong.me/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.karnwong.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.karnwong.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://www.karnwong.me/>Home</a>&nbsp;»&nbsp;<a href=https://www.karnwong.me/tags/>Tags</a></div><h1>data engineering</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Data engineering toolset (that I use) glossary</h2></header><div class=entry-content><p>Big data Spark: Map-reduce framework for dealing with big data, especially for data that doesn’t fit into memory. Utilizes parallelization. Cloud AWS: Cloud platform for many tools used in software engineering. AWS Fargate: A task launch mode for ECS task, where it automatically shuts down once a container exits. With EC2 launch mode, you’ll have to turn off the machine yourself. AWS Lambda: Serverless function, can be used with docker image too....</p></div><footer class=entry-footer><span title='2021-06-04 23:57:58 +0700 +07'>June 4, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Karn Wong</footer><a class=entry-link aria-label="post link to Data engineering toolset (that I use) glossary" href=https://www.karnwong.me/posts/2021/06/data-engineering-toolset-that-i-use-glossary/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Shapefile to data lake</h2></header><div class=entry-content><p>Background: we use spark to read/write to data lake. For dealing with spatial data & analysis, we use sedona. Shapefile is converted to TSV then read by spark for further processing & archival.
Recently I had to archive shapefiles in our data lake. It wasn’t rosy for the following reasons:
Invalid geometries Sedona (and geopandas too) whines if it encounters invalid geometry during geometry casting. The invalid geometries could be from many reasons, one of them being unclean polygon clipping....</p></div><footer class=entry-footer><span title='2021-04-23 18:25:13 +0000 UTC'>April 23, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Karn Wong</footer><a class=entry-link aria-label="post link to Shapefile to data lake" href=https://www.karnwong.me/posts/2021/04/shapefile-to-data-lake/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Spark join OOM fix</h2></header><div class=entry-content><p>I have a big pipelines where one step performs crossjoin on 130K x 7K. It fails quite often, and I have to pray to the Rice God for it to pass. Today I found the solution: repartition before crossjoin.
The root cause is that the dataframe with 130K records has 6 partitions, so when I perform crossjoin (one-to-many) it’s working against those 6 partitions. Total output in parquet is around 350MB, which means my computer (8 cores, 10GB RAM provisioned for spark) needs to be able to hold all uncompressed data in memory....</p></div><footer class=entry-footer><span title='2021-04-11 16:20:23 +0000 UTC'>April 11, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Karn Wong</footer><a class=entry-link aria-label="post link to Spark join OOM fix" href=https://www.karnwong.me/posts/2021/04/spark-join-oom-fix/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Workarounds for archiving large shapefile in data lake</h2></header><div class=entry-content><p>If you work with spatial data, chances are you are familiar with shapefile, a file format for viewing / editing spatial data.
Essentially, shapefile is just a tabular data like csv, but it does thingamajig with geometry data type, where any gis tools like qgis or arcgis can understand right away. If you have a csv file with geometry column in wkt format (something like POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))), you’ll have to specify which column is to be used for geometry....</p></div><footer class=entry-footer><span title='2021-01-31 17:40:53 +0000 UTC'>January 31, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Karn Wong</footer><a class=entry-link aria-label="post link to Workarounds for archiving large shapefile in data lake" href=https://www.karnwong.me/posts/2021/01/workarounds-for-archiving-large-shapefile-in-data-lake/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Mongodb export woes</h2></header><div class=entry-content><p>There’s a task where I need to export 4M+ records out of mongodb, total uncompressed size is 17GB+ 26GB
export methods mongoexport The recommended way to export is using mongoexport utility, but you have to specify the output attributes, which doesn’t work for me because the schema from older set of records are less than the newer set
DIY python script the vanilla way But you can interact with mongodb from python, and if you read from it it’ll return a dict, which is perfect for this because you don’t have to specify the required attributes beforehand....</p></div><footer class=entry-footer><span title='2021-01-27 04:51:41 +0000 UTC'>January 27, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Karn Wong</footer><a class=entry-link aria-label="post link to Mongodb export woes" href=https://www.karnwong.me/posts/2021/01/mongodb-export-woes/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://www.karnwong.me/tags/data-engineering/>«&nbsp;Prev&nbsp;</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://www.karnwong.me/>Karn Wong</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>