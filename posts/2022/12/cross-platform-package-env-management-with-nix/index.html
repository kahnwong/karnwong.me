<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cross-platform package (+env) management with Nix | Karn Wong</title><meta name=keywords content="devops"><meta name=description content="For many years, installing a package on linux means either:
Compiling a binary from source, then install it. -> I think we know why this didn&rsquo;t catch on for the mass. Downloading a compiled binary for your system&rsquo;s architecture and platform. -> This requires you to also move the executable to something like /usr/local/bin otherwise it won&rsquo;t be discoverable throughout the system. Using system&rsquo;s package manager: apt, apk, yum, brew, etc."><meta name=author content="Karn Wong"><link rel=canonical href=https://www.karnwong.me/posts/2022/12/cross-platform-package-env-management-with-nix/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.karnwong.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.karnwong.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.karnwong.me/favicon-32x32.png><link rel=apple-touch-icon href=https://www.karnwong.me/apple-touch-icon.png><link rel=mask-icon href=https://www.karnwong.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYMFC0KZ9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8CYMFC0KZ9",{anonymize_ip:!1})}</script><meta property="og:title" content="Cross-platform package (+env) management with Nix"><meta property="og:description" content="For many years, installing a package on linux means either:
Compiling a binary from source, then install it. -> I think we know why this didn&rsquo;t catch on for the mass. Downloading a compiled binary for your system&rsquo;s architecture and platform. -> This requires you to also move the executable to something like /usr/local/bin otherwise it won&rsquo;t be discoverable throughout the system. Using system&rsquo;s package manager: apt, apk, yum, brew, etc."><meta property="og:type" content="article"><meta property="og:url" content="https://www.karnwong.me/posts/2022/12/cross-platform-package-env-management-with-nix/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-03T19:45:36+07:00"><meta property="article:modified_time" content="2022-12-03T19:45:36+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cross-platform package (+env) management with Nix"><meta name=twitter:description content="For many years, installing a package on linux means either:
Compiling a binary from source, then install it. -> I think we know why this didn&rsquo;t catch on for the mass. Downloading a compiled binary for your system&rsquo;s architecture and platform. -> This requires you to also move the executable to something like /usr/local/bin otherwise it won&rsquo;t be discoverable throughout the system. Using system&rsquo;s package manager: apt, apk, yum, brew, etc."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.karnwong.me/posts/"},{"@type":"ListItem","position":2,"name":"Cross-platform package (+env) management with Nix","item":"https://www.karnwong.me/posts/2022/12/cross-platform-package-env-management-with-nix/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cross-platform package (+env) management with Nix","name":"Cross-platform package (\u002benv) management with Nix","description":"For many years, installing a package on linux means either:\nCompiling a binary from source, then install it. -\u0026gt; I think we know why this didn\u0026rsquo;t catch on for the mass. Downloading a compiled binary for your system\u0026rsquo;s architecture and platform. -\u0026gt; This requires you to also move the executable to something like /usr/local/bin otherwise it won\u0026rsquo;t be discoverable throughout the system. Using system\u0026rsquo;s package manager: apt, apk, yum, brew, etc.","keywords":["devops"],"articleBody":"For many years, installing a package on linux means either:\nCompiling a binary from source, then install it. -\u003e I think we know why this didn‚Äôt catch on for the mass. Downloading a compiled binary for your system‚Äôs architecture and platform. -\u003e This requires you to also move the executable to something like /usr/local/bin otherwise it won‚Äôt be discoverable throughout the system. Using system‚Äôs package manager: apt, apk, yum, brew, etc. -\u003e Yay finally something that‚Äôs easy to use. Phew! Then the dot-com era happened, and the digital transformation, you name it. This was before cloud, so companies set up their own data centers and have to administer and maintain the servers themselves. And it‚Äôs not fun if you have to perform the same machine configuration for the whole fleet. This problem was solved by tools like Ansible, Chef, Puppet, etc, to set up a machine‚Äôs configuration en masse.\nSo why is this still an issue? Because there are sizable amount of developers / engineers working on a Mac, and deploy to a Unix-based system. This means those machine setup configurations don‚Äôt work with Mac, and vice versa, because they use different package managers. Technically you can create a separate set of configs for Mac, but this means maintaining two different setup scripts, which aim to do the same thing, just on different platforms. Sooner or later the configuration would get out of sync üò±.\nHowever there are still issues with using system‚Äôs package manager in linux, namely for some bleeding edge packages, or new package versions that are not yet available in your current linux version, usually involve adding an explicit repository url, adding a keyring, or having to upgrade the system altogether so it can fetch the new repository isn‚Äôt fun. I‚Äôve yet to see why we can‚Äôt install a new package version when its functionalities have almost nothing to do with system version. Otherwise system‚Äôs package manager is fast and reliable.\nMeanwhile there‚Äôs brew for darwin. I only use it because it was one of the few options we have as close as an actual package manager. But it‚Äôs very slow and performing repo update and installing new apps can take forever, especially if you have to check multiple packages.\nNot only that, once you have initialized a system, and over time you modified its configurations, how can you be sure that all the changes are populated back to your Ansible script? This would be a manual process prone to errors.\nBut humans are awesome, so the best and brightest came up with nix, as in *nix, a cross-platform package manager that works on both Unix and darwin (a platform name of Mac OS).\nWith nix, you can utilize home-manager to populate the packages/configs on your system, in which it would symlink your configs to nix home, to be symlinked via home-manager switch to actual destination, with read only file permission. This means if you use nix to initialize ~/.ssh/config and you want to change it by hand, it would throw ‚Äúthis file has read-only permission‚Äù error, this way the only way to update the configs is through nix.\nAlso with the full system configurations, it takes 6 seconds flat to apply the delta diff üòé.\nSome interesting snippets from home.nix:\nInitialize dotfiles home.file.\".ssh/config\".source = ./dotfiles/.ssh/config; Git config Notice the delta block, this automatically populate required configs in .gitignore.\nprograms.git = { # git config --global --edit for raw config content enable = true; userName = \"\"; userEmail = \"\"; delta = { enable = true; options = { navigate = true; side-by-side = true; }; }; extraConfig = { diff.colorMoved = \"default\"; merge.conflictstyle = \"diff3\"; }; }; Neovim config Nix doesn‚Äôt use vim-plug by default, and I found some plugins failed installing via nix, hence the extraConfig block for installing vim plugins. Don‚Äôt forget to run nvim --headless +PlugInstall +qall.\nprograms.neovim = { enable = true; viAlias = true; vimAlias = true; vimdiffAlias = true; plugins = with pkgs.vimPlugins; [ vim-plug ]; extraConfig = '' runtime! plug.vim call plug#begin() \"diff Plug 'mhinz/vim-signify' call plug#end() \"\"\"\" config set number ''; }; Conditional package list for each platform Maybe you only use linux for servers, so you might not need GUI apps, or some packages are not available on darwin, etc.\nhome.packages = with pkgs; let # Packages to always install. common = [ fish starship ]; linux_only = [ iotop ntfs3g progress ]; mac_only = [ mpv ]; in common ++ (if stdenv.isLinux then linux_only else mac_only); Head over to the repo for my full setup. And remember: great artists steal.\n","wordCount":"764","inLanguage":"en","datePublished":"2022-12-03T19:45:36+07:00","dateModified":"2022-12-03T19:45:36+07:00","author":{"@type":"Person","name":"Karn Wong"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.karnwong.me/posts/2022/12/cross-platform-package-env-management-with-nix/"},"publisher":{"@type":"Organization","name":"Karn Wong","logo":{"@type":"ImageObject","url":"https://www.karnwong.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.karnwong.me/ accesskey=h title="Karn Wong (Alt + H)">Karn Wong</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.karnwong.me/about/ title=About><span>About</span></a></li><li><a href=https://www.karnwong.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://www.karnwong.me/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.karnwong.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.karnwong.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.karnwong.me/>Home</a>&nbsp;¬ª&nbsp;<a href=https://www.karnwong.me/posts/>Posts</a></div><h1 class=post-title>Cross-platform package (+env) management with Nix</h1><div class=post-meta><span title='2022-12-03 19:45:36 +0700 +07'>December 3, 2022</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;Karn Wong</div></header><div class=post-content><p>For many years, installing a package on linux means either:</p><ul><li>Compiling a binary from source, then install it. -> I think we know why this didn&rsquo;t catch on for the mass.</li><li>Downloading a compiled binary for your system&rsquo;s architecture and platform. -> This requires you to also move the executable to something like <code>/usr/local/bin</code> otherwise it won&rsquo;t be discoverable throughout the system.</li><li>Using system&rsquo;s package manager: <code>apt</code>, <code>apk</code>, <code>yum</code>, <code>brew</code>, etc. -> Yay finally something that&rsquo;s easy to use. Phew!</li></ul><p>Then the dot-com era happened, and the digital transformation, you name it. This was before cloud, so companies set up their own data centers and have to administer and maintain the servers themselves. And it&rsquo;s not fun if you have to perform the same machine configuration for the whole fleet. This problem was solved by tools like Ansible, Chef, Puppet, etc, to set up a machine&rsquo;s configuration en masse.</p><p>So why is this still an issue? Because there are sizable amount of developers / engineers working on a Mac, and deploy to a Unix-based system. This means those machine setup configurations don&rsquo;t work with Mac, and vice versa, because they use different package managers. Technically you can create a separate set of configs for Mac, but this means maintaining two different setup scripts, which aim to do the same thing, just on different platforms. Sooner or later the configuration would get out of sync üò±.</p><p>However there are still issues with using system&rsquo;s package manager in linux, namely for some bleeding edge packages, or new package versions that are not yet available in your current linux version, usually involve adding an explicit repository url, adding a keyring, or having to upgrade the system altogether so it can fetch the new repository isn&rsquo;t fun. I&rsquo;ve yet to see why we can&rsquo;t install a new package version when its functionalities have almost nothing to do with system version. Otherwise system&rsquo;s package manager is fast and reliable.</p><p>Meanwhile there&rsquo;s <code>brew</code> for darwin. I only use it because it was one of the few options we have as close as an actual package manager. But it&rsquo;s very slow and performing repo update and installing new apps can take forever, especially if you have to check multiple packages.</p><p>Not only that, once you have initialized a system, and over time you modified its configurations, how can you be sure that all the changes are populated back to your Ansible script? This would be a manual process prone to errors.</p><p>But humans are awesome, so the best and brightest came up with <code>nix</code>, as in <code>*nix</code>, a cross-platform package manager that works on both Unix and darwin (a platform name of Mac OS).</p><p>With nix, you can utilize <code>home-manager</code> to populate the packages/configs on your system, in which it would symlink your configs to nix home, to be symlinked via <code>home-manager switch</code> to actual destination, with <code>read only</code> file permission. This means if you use nix to initialize <code>~/.ssh/config</code> and you want to change it by hand, it would throw &ldquo;this file has read-only permission&rdquo; error, this way the only way to update the configs is through nix.</p><p>Also with the full system configurations, it takes 6 seconds flat to apply the delta diff üòé.</p><p>Some interesting snippets from <code>home.nix</code>:</p><h2 id=initialize-dotfiles>Initialize dotfiles<a hidden class=anchor aria-hidden=true href=#initialize-dotfiles>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home<span style=color:#f92672>.</span>file<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;.ssh/config&#34;</span><span style=color:#f92672>.</span>source <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#e6db74>./dotfiles/.ssh/config</span>;
</span></span></code></pre></div><h2 id=git-config>Git config<a hidden class=anchor aria-hidden=true href=#git-config>#</a></h2><p>Notice the <code>delta</code> block, this automatically populate required configs in <code>.gitignore</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>programs<span style=color:#f92672>.</span>git <span style=color:#960050;background-color:#1e0010>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e># git config --global --edit for raw config content</span>
</span></span><span style=display:flex><span>  enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  userName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>  userEmail <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  delta <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    options <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      navigate <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      side-by-side <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  extraConfig <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    diff<span style=color:#f92672>.</span>colorMoved <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;default&#34;</span>;
</span></span><span style=display:flex><span>    merge<span style=color:#f92672>.</span>conflictstyle <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;diff3&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=neovim-config>Neovim config<a hidden class=anchor aria-hidden=true href=#neovim-config>#</a></h2><p>Nix doesn&rsquo;t use <code>vim-plug</code> by default, and I found some plugins failed installing via nix, hence the <code>extraConfig</code> block for installing vim plugins. Don&rsquo;t forget to run <code>nvim --headless +PlugInstall +qall</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>programs<span style=color:#f92672>.</span>neovim <span style=color:#960050;background-color:#1e0010>=</span> {
</span></span><span style=display:flex><span>  enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  viAlias <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  vimAlias <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  vimdiffAlias <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  plugins <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs<span style=color:#f92672>.</span>vimPlugins; [
</span></span><span style=display:flex><span>    vim-plug
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  extraConfig <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    runtime! plug.vim
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    call plug#begin()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;diff
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Plug &#39;mhinz/vim-signify&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    call plug#end()
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;&#34; config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    set number
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=conditional-package-list-for-each-platform>Conditional package list for each platform<a hidden class=anchor aria-hidden=true href=#conditional-package-list-for-each-platform>#</a></h2><p>Maybe you only use linux for servers, so you might not need GUI apps, or some packages are not available on darwin, etc.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>home<span style=color:#f92672>.</span>packages <span style=color:#960050;background-color:#1e0010>=</span> <span style=color:#66d9ef>with</span> pkgs;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Packages to always install.</span>
</span></span><span style=display:flex><span>    common <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      fish
</span></span><span style=display:flex><span>      starship
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    linux_only <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      iotop
</span></span><span style=display:flex><span>      ntfs3g
</span></span><span style=display:flex><span>      progress
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    mac_only <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      mpv
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>  common <span style=color:#f92672>++</span> (<span style=color:#66d9ef>if</span> stdenv<span style=color:#f92672>.</span>isLinux <span style=color:#66d9ef>then</span> linux_only <span style=color:#66d9ef>else</span> mac_only);
</span></span></code></pre></div><p>Head over to the <a href=https://github.com/kahnwong/nix>repo</a> for my full setup. And remember: great artists <em>steal</em>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.karnwong.me/tags/devops/>devops</a></li></ul><nav class=paginav><a class=prev href=https://www.karnwong.me/posts/2022/12/load-balancers-101-thou-shalt-not-be-alone/><span class=title>¬´ Prev</span><br><span>Load balancer 101, thou shalt not be alone</span></a>
<a class=next href=https://www.karnwong.me/posts/2022/11/load-credentials-into-your-shell-via-bitwarden-cli---fish-edition/><span class=title>Next ¬ª</span><br><span>Load credentials into your shell via Bitwarden CLI - Fish edition</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.karnwong.me/>Karn Wong</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>