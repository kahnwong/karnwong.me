<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Intro to Pulumi | Karn Wong</title><meta name=keywords content="devops,pulumi,aws"><meta name=description content="For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.
Challenge url: https://www.pulumi.com/challenge/startup-in-a-box/
Pre-requisites Pulumi account Checkly account AWS acount Install Pulumi cli: brew install pulumi/tap/pulumi Steps Init Init pulumi project"><meta name=author content="Karn Wong"><link rel=canonical href=https://www.karnwong.me/posts/2022/09/intro-to-pulumi/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.karnwong.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.karnwong.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.karnwong.me/favicon-32x32.png><link rel=apple-touch-icon href=https://www.karnwong.me/apple-touch-icon.png><link rel=mask-icon href=https://www.karnwong.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYMFC0KZ9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8CYMFC0KZ9",{anonymize_ip:!1})}</script><meta property="og:title" content="Intro to Pulumi"><meta property="og:description" content="For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.
Challenge url: https://www.pulumi.com/challenge/startup-in-a-box/
Pre-requisites Pulumi account Checkly account AWS acount Install Pulumi cli: brew install pulumi/tap/pulumi Steps Init Init pulumi project"><meta property="og:type" content="article"><meta property="og:url" content="https://www.karnwong.me/posts/2022/09/intro-to-pulumi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-26T15:06:11+07:00"><meta property="article:modified_time" content="2022-09-26T15:06:11+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Intro to Pulumi"><meta name=twitter:description content="For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.
Challenge url: https://www.pulumi.com/challenge/startup-in-a-box/
Pre-requisites Pulumi account Checkly account AWS acount Install Pulumi cli: brew install pulumi/tap/pulumi Steps Init Init pulumi project"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.karnwong.me/posts/"},{"@type":"ListItem","position":2,"name":"Intro to Pulumi","item":"https://www.karnwong.me/posts/2022/09/intro-to-pulumi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Intro to Pulumi","name":"Intro to Pulumi","description":"For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.\nChallenge url: https://www.pulumi.com/challenge/startup-in-a-box/\nPre-requisites Pulumi account Checkly account AWS acount Install Pulumi cli: brew install pulumi/tap/pulumi Steps Init Init pulumi project","keywords":["devops","pulumi","aws"],"articleBody":"For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.\nChallenge url: https://www.pulumi.com/challenge/startup-in-a-box/\nPre-requisites Pulumi account Checkly account AWS acount Install Pulumi cli: brew install pulumi/tap/pulumi Steps Init Init pulumi project\nmkdir pulumi-challenge-startup-in-a-box pulumi new aws-typescript Create S3 bucket Then we are going to create an s3 bucket to host static website, your index.ts should look like this:\nimport * as pulumi from \"@pulumi/pulumi\"; import * as aws from \"@pulumi/aws\"; import * as awsx from \"@pulumi/awsx\"; const bucket = new aws.s3.BucketV2(\"bucketV2\", { tags: { Name: \"pulumi-challenge-karn-wong\", }, }); const bucketAcl = new aws.s3.BucketAclV2(\"bAcl\", { bucket: bucket.id, acl: aws.s3.PublicReadAcl, }); Set MIME type To set MIME type, we could leverage Node API:\nnpm install mime @types/mime Then append this to index.ts:\nimport * as fs from \"fs\"; import * as mime from \"mime\"; const staticWebsiteDirectory = \"website\"; fs.readdirSync(staticWebsiteDirectory).forEach((file) =\u003e { const filePath = `${staticWebsiteDirectory}/${file}`; const fileContent = fs.readFileSync(filePath).toString(); new aws.s3.BucketObject(file, { bucket: bucket.id, source: new pulumi.asset.FileAsset(filePath), contentType: mime.getType(filePath) || undefined, acl: aws.s3.PublicReadAcl, }); }); Create static assets But we are going to serve a static website, so we need to provide static assets:\nwebsite/index.html \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003cmeta charset=\"utf-8\" /\u003e \u003ctitle\u003ePulumi Challenge\u003c/title\u003e \u003clink rel=\"stylesheet\" href=\"style.css\" /\u003e \u003clink rel=\"stylesheet\" href=\"normalize.css\" /\u003e \u003c/head\u003e \u003cbody\u003e \u003cheader\u003e \u003cdiv class=\"logo\"\u003e \u003cul\u003e \u003cli\u003e\u003ci class=\"fas fa-feather\"\u003e\u003c/i\u003e\u003c/li\u003e \u003cli\u003e\u003cp\u003eCompany Name\u003c/p\u003e\u003c/li\u003e \u003c/ul\u003e \u003c/div\u003e \u003cul class=\"social\"\u003e \u003cli\u003e \u003ca href=\"http://github.com/\" target=\"_blank\" \u003e\u003ci class=\"fab fa-github-alt\"\u003e\u003c/i \u003e\u003c/a\u003e \u003c/li\u003e \u003cli\u003e \u003ca href=\"http://twitter.com/\" target=\"_blank\" \u003e\u003ci class=\"fab fa-twitter\"\u003e\u003c/i \u003e\u003c/a\u003e \u003c/li\u003e \u003cli\u003e \u003ca href=\"http://linkedin.com/\" target=\"_blank\" \u003e\u003ci class=\"fab fa-linkedin-in\"\u003e\u003c/i \u003e\u003c/a\u003e \u003c/li\u003e \u003c/ul\u003e \u003c/header\u003e \u003cdiv class=\"banner\"\u003e \u003ch1\u003eYour Startup Name Here\u003c/h1\u003e \u003ch3\u003eYour Tagline\u003c/h3\u003e \u003cp\u003e We're $CompanyName, and we're changing what it means to $Task. Our innovative use of $Technology makes life easier for $JobTitles, so they can focus on what they're really good at instead of wasting time and effort on $MenialOrDifficultTask. Streamline your $TaskProcess with $Product and take to the skies! \u003c/p\u003e \u003c/div\u003e \u003c/body\u003e \u003cscript src=\"https://kit.fontawesome.com/b4747495ea.js\" crossorigin=\"anonymous\" \u003e\u003c/script\u003e \u003c/html\u003e website/style.css @import url(\"https://fonts.googleapis.com/css?family=News+Cycle|Teko\u0026display=swap\"); body { background-color: #f7f7fa; opacity: 0.8; background-image: radial-gradient(#f79645 0.5px, #f7f7fa 0.5px); background-size: 10px 10px; } ul { list-style-type: none; } ul li { display: inline-block; } a { color: white; -webkit-transition: color 0.5s ease-out; transition: color 0.5s ease-out; text-decoration: none; } a:hover, a:active { color: rgb(55, 188, 250); } header { background-color: rgba(214, 73, 73, 0.6); height: 80px; position: absolute; top: 0; width: 100%; box-shadow: 0px 2px 7px -1px rgba(0, 0, 0, 0.75); -webkit-box-shadow: 0px 2px 7px -1px rgba(0, 0, 0, 0.75); -moz-box-shadow: 0px 2px 7px -1px rgba(0, 0, 0, 0.75); } header li { color: white; } .active a { color: rgb(255, 157, 112); } .social { position: absolute; right: 50px; top: -5px; font-size: 30px; } .social li { margin: 0 5px 0 5px; } .logo { font-family: Teko; position: absolute; left: 5px; top: -60px; font-size: 40px; } .banner { width: 60vw; font-family: Teko; font-size: 2vw; text-align: center; margin-top: 15vw; margin-left: 20vw; } .banner h1 { color: rgb(214, 73, 73); } .banner p, .about p { font-family: News Cycle; } website/normalize.css Download from https://github.com/necolas/normalize.css/blob/master/normalize.css\nCreate Cloudfront CDN We can always fetch the site via s3 directly, but your s3 bucket is in a single region. Users in far-away-regions might have a significant latency. To circumvent this, we could utilize CDN to reduce the site latency, since CDN would serve the content from a region nearest to users. To achieve this, append the following to index.ts:\nconst s3OriginId = \"myS3Origin\"; const cloudfrontDistribution = new aws.cloudfront.Distribution( \"s3Distribution\", { origins: [ { domainName: bucket.bucketRegionalDomainName, originId: s3OriginId, }, ], enabled: true, isIpv6Enabled: true, comment: \"Some comment\", defaultRootObject: \"index.html\", defaultCacheBehavior: { allowedMethods: [ \"DELETE\", \"GET\", \"HEAD\", \"OPTIONS\", \"PATCH\", \"POST\", \"PUT\", ], cachedMethods: [\"GET\", \"HEAD\"], targetOriginId: s3OriginId, forwardedValues: { queryString: false, cookies: { forward: \"none\", }, }, viewerProtocolPolicy: \"allow-all\", minTtl: 0, defaultTtl: 3600, maxTtl: 86400, }, priceClass: \"PriceClass_200\", restrictions: { geoRestriction: { restrictionType: \"whitelist\", locations: [\"US\", \"CA\", \"GB\", \"DE\"], }, }, viewerCertificate: { cloudfrontDefaultCertificate: true, }, } ); Reusable module Think of it as instead of creating resources manually all the time, you can call a function instead. Refactor away we go!\nRemove cloudfront block in index.ts Create cdn-website/index.ts with following content: import * as pulumi from \"@pulumi/pulumi\"; import * as aws from \"@pulumi/aws\"; import * as fs from \"fs\"; import * as mime from \"mime\"; // This is a simpler verison of: // https://github.com/pulumi/pulumi-aws-static-website export class CdnWebsite extends pulumi.ComponentResource { private bucket: aws.s3.BucketV2; private bucketAcl: aws.s3.BucketAclV2; private cloudfrontDistribution: aws.cloudfront.Distribution; private s3OriginId: string = \"myS3Origin\"; private staticWebsiteDirectory: string = \"./website\"; constructor(name: string, args: any, opts?: pulumi.ComponentResourceOptions) { super(\"pulumi:challenge:CdnWebsite\", name, args, opts); this.bucket = new aws.s3.BucketV2( \"bucketV2\", { tags: { Name: \"My bucket\", }, }, { parent: this, } ); this.bucketAcl = new aws.s3.BucketAclV2( \"bAcl\", { bucket: this.bucket.id, acl: aws.s3.PublicReadAcl, }, { parent: this, } ); this.cloudfrontDistribution = new aws.cloudfront.Distribution( \"s3Distribution\", { origins: [ { domainName: this.bucket.bucketRegionalDomainName, originId: this.s3OriginId, }, ], enabled: true, isIpv6Enabled: true, comment: \"Some comment\", defaultRootObject: \"index.html\", defaultCacheBehavior: { allowedMethods: [ \"DELETE\", \"GET\", \"HEAD\", \"OPTIONS\", \"PATCH\", \"POST\", \"PUT\", ], cachedMethods: [\"GET\", \"HEAD\"], targetOriginId: this.s3OriginId, forwardedValues: { queryString: false, cookies: { forward: \"none\", }, }, viewerProtocolPolicy: \"allow-all\", minTtl: 0, defaultTtl: 3600, maxTtl: 86400, }, priceClass: \"PriceClass_200\", restrictions: { geoRestriction: { restrictionType: \"whitelist\", locations: [\"US\", \"CA\", \"GB\", \"DE\"], }, }, viewerCertificate: { cloudfrontDefaultCertificate: true, }, }, { parent: this, } ); fs.readdirSync(this.staticWebsiteDirectory).forEach((file) =\u003e { const filePath = `${this.staticWebsiteDirectory}/${file}`; const fileContent = fs.readFileSync(filePath).toString(); new aws.s3.BucketObject( file, { bucket: this.bucket.id, source: new pulumi.asset.FileAsset(filePath), contentType: mime.getType(filePath) || undefined, acl: aws.s3.PublicReadAcl, }, { parent: this.bucket, } ); }); // We also need to register all the expected outputs for this // component resource that will get returned by default. this.registerOutputs({ bucketName: this.bucket.id, cdnUrl: this.cloudfrontDistribution.domainName, }); } get url(): pulumi.Output\u003cstring\u003e { return this.cloudfrontDistribution.domainName; } } Inindex.ts modify the file so that it looks like this: // Deploy Website to S3 with CloudFront // Also shows the challenger how to build a ComponentResource import { CdnWebsite } from \"./cdn-website\"; const website = new CdnWebsite(\"your-startup\", {}); Sanity checks If everything works correctly, we should be able to deploy the website. But it would be so much better if we can see whether the website is working normally or not. Status checks to the rescue!\nHere we set up checkly provider:\nnpm install @checkly/pulumi # API KEY: https://app.checklyhq.com/settings/account/api-keys pulumi config set checkly:apiKey --secret # AccountID: https://app.checklyhq.com/settings/account/general pulumi config set checkly:accountId Then append this to index.ts:\nexport const websiteUrl = website.url; import * as checkly from \"@checkly/pulumi\"; import * as fs from \"fs\"; new checkly.Check(\"index-page\", { activated: true, frequency: 10, type: \"BROWSER\", locations: [\"eu-west-2\"], script: websiteUrl.apply((url) =\u003e fs .readFileSync(\"checkly-embed.js\") .toString(\"utf8\") .replace(\"{{websiteUrl}}\", url) ), }); But we need to supply logic for sanity checks, we can do this by creating checkly-embed.js (which the above checkly resource fetches).\nconst playwright = require(\"playwright\"); const expect = require(\"expect\"); const browser = await playwright.chromium.launch(); const page = await browser.newPage(); await page.goto(\"https://{{websiteUrl}}\"); expect(await page.title()).toBe(\"Pulumi Challenge\"); await browser.close(); Cherry on top (who wants swags?) Kindly provided by folks at Pulumi, we can get cool swags by calling an API endpoint as follows:\nnpm install got@11.8.0 Then paste the following in swag-provider/index.ts:\nimport * as pulumi from \"@pulumi/pulumi\"; const submittionUrl: string = \"https://hooks.airtable.com/workflows/v1/genericWebhook/apptZjyaJx5J2BVri/wflmg3riOP6fPjCII/wtr3RoDcz3mTizw3C\"; interface SwagInputs { name: string; email: string; address: string; size: \"XS\" | \"S\" | \"M\" | \"L\" | \"XL\" | \"XXL\" | \"XXXL\"; } interface SwagCreateResponse { success: boolean; } interface SwagOutputs extends SwagInputs { id: string; } class SwagProvider implements pulumi.dynamic.ResourceProvider { private name: string; constructor(name: string) { this.name = name; } async create(props: SwagInputs): Promise\u003cpulumi.dynamic.CreateResult\u003e { const got = (await import(\"got\")).default; let data = await got .post(submittionUrl, { headers: { \"Content-Type\": \"application/json\", }, json: { ...props, }, }) .json\u003cSwagCreateResponse\u003e(); return { id: props.email, outs: props }; } } export class Swag extends pulumi.dynamic.Resource { constructor( name: string, props: SwagInputs, opts?: pulumi.CustomResourceOptions ) { super(new SwagProvider(name), name, props, opts); } } Finally, paste this to index.ts:\nimport { Swag } from \"./swag-provider\"; const swag = new Swag(\"your-startup\", { name: \"YOUR NAME\", email: \"YOUR EMAIL\", address: \"YOUR ADDRESS\", size: SIZE, }); Open sesame â€˜Nuff said\npulumi up If everything works correctly, your terminal should display something like this:\nPreviewing update (dev) View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/previews/xxxxxxxx Type Name Plan + pulumi:pulumi:Stack pulumi-challenge-startup-in-a-box-dev create + â”œâ”€ pulumi:challenge:CdnWebsite your-startup create + â”‚ â”œâ”€ aws:s3:BucketV2 bucketV2 create + â”‚ â”‚ â”œâ”€ aws:s3:BucketObject index.html create + â”‚ â”‚ â”œâ”€ aws:s3:BucketObject style.css create + â”‚ â”‚ â””â”€ aws:s3:BucketObject normalize.css create + â”‚ â”œâ”€ aws:s3:BucketAclV2 bAcl create + â”‚ â””â”€ aws:cloudfront:Distribution s3Distribution create + â”œâ”€ pulumi-nodejs:dynamic:Resource your-startup create + â””â”€ checkly:index:Check index-page create Outputs: websiteUrl: output Resources: + 10 to create Do you want to perform this update? yes Updating (dev) View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/updates/1 Type Name Status + pulumi:pulumi:Stack pulumi-challenge-startup-in-a-box-dev created + â”œâ”€ pulumi:challenge:CdnWebsite your-startup created + â”‚ â”œâ”€ aws:s3:BucketV2 bucketV2 created + â”‚ â”‚ â”œâ”€ aws:s3:BucketObject style.css created + â”‚ â”‚ â”œâ”€ aws:s3:BucketObject index.html created + â”‚ â”‚ â””â”€ aws:s3:BucketObject normalize.css created + â”‚ â”œâ”€ aws:cloudfront:Distribution s3Distribution created + â”‚ â””â”€ aws:s3:BucketAclV2 bAcl created + â”œâ”€ pulumi-nodejs:dynamic:Resource your-startup created + â””â”€ checkly:index:Check index-page created Outputs: websiteUrl: \"dyacxs5ksi1r9.cloudfront.net\" Resources: + 10 created Duration: 3m25s Donâ€™t you love it when everything works as you planned ðŸ˜Ž.\nTo teardown all resources, run pulumi destroy. If successful, your terminal should return:\nPreviewing destroy (dev) View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/previews/xxxxxxxx Type Name Plan - pulumi:pulumi:Stack pulumi-challenge-startup-in-a-box-dev delete - â”œâ”€ checkly:index:Check index-page delete - â”œâ”€ pulumi-nodejs:dynamic:Resource your-startup delete - â””â”€ pulumi:challenge:CdnWebsite your-startup delete - â”œâ”€ aws:cloudfront:Distribution s3Distribution delete - â”œâ”€ aws:s3:BucketAclV2 bAcl delete - â””â”€ aws:s3:BucketV2 bucketV2 delete - â”œâ”€ aws:s3:BucketObject normalize.css delete - â”œâ”€ aws:s3:BucketObject style.css delete - â””â”€ aws:s3:BucketObject index.html delete Outputs: - websiteUrl: \"dyacxs5ksi1r9.cloudfront.net\" Resources: - 10 to delete Do you want to perform this destroy? yes Destroying (dev) View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/updates/2 Type Name Status - pulumi:pulumi:Stack pulumi-challenge-startup-in-a-box-dev deleted - â”œâ”€ checkly:index:Check index-page deleted - â”œâ”€ pulumi-nodejs:dynamic:Resource your-startup deleted - â””â”€ pulumi:challenge:CdnWebsite your-startup deleted - â”œâ”€ aws:cloudfront:Distribution s3Distribution deleted - â”œâ”€ aws:s3:BucketAclV2 bAcl deleted - â””â”€ aws:s3:BucketV2 bucketV2 deleted - â”œâ”€ aws:s3:BucketObject index.html deleted - â”œâ”€ aws:s3:BucketObject normalize.css deleted - â””â”€ aws:s3:BucketObject style.css deleted Outputs: - websiteUrl: \"dyacxs5ksi1r9.cloudfront.net\" Resources: - 10 deleted Duration: 3m22s The resources in the stack have been deleted, but the history and configuration associated with the stack are still maintained. If you want to remove the stack completely, run `pulumi stack rm dev`. ","wordCount":"1760","inLanguage":"en","datePublished":"2022-09-26T15:06:11+07:00","dateModified":"2022-09-26T15:06:11+07:00","author":{"@type":"Person","name":"Karn Wong"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.karnwong.me/posts/2022/09/intro-to-pulumi/"},"publisher":{"@type":"Organization","name":"Karn Wong","logo":{"@type":"ImageObject","url":"https://www.karnwong.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.karnwong.me/ accesskey=h title="Karn Wong (Alt + H)">Karn Wong</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.karnwong.me/about/ title=About><span>About</span></a></li><li><a href=https://www.karnwong.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://www.karnwong.me/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.karnwong.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.karnwong.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.karnwong.me/>Home</a>&nbsp;Â»&nbsp;<a href=https://www.karnwong.me/posts/>Posts</a></div><h1 class=post-title>Intro to Pulumi</h1><div class=post-meta><span title='2022-09-26 15:06:11 +0700 +07'>September 26, 2022</span>&nbsp;Â·&nbsp;9 min&nbsp;Â·&nbsp;Karn Wong</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pre-requisites aria-label=Pre-requisites>Pre-requisites</a></li><li><a href=#steps aria-label=Steps>Steps</a><ul><li><a href=#init aria-label=Init>Init</a></li><li><a href=#create-s3-bucket aria-label="Create S3 bucket">Create S3 bucket</a></li><li><a href=#set-mime-type aria-label="Set MIME type">Set MIME type</a></li><li><a href=#create-static-assets aria-label="Create static assets">Create static assets</a><ul><li><a href=#websiteindexhtml aria-label=website/index.html><code>website/index.html</code></a></li><li><a href=#websitestylecss aria-label=website/style.css><code>website/style.css</code></a></li><li><a href=#websitenormalizecss aria-label=website/normalize.css><code>website/normalize.css</code></a></li></ul></li><li><a href=#create-cloudfront-cdn aria-label="Create Cloudfront CDN">Create Cloudfront CDN</a></li><li><a href=#reusable-module aria-label="Reusable module">Reusable module</a></li><li><a href=#sanity-checks aria-label="Sanity checks">Sanity checks</a></li><li><a href=#cherry-on-top-who-wants-swags aria-label="Cherry on top (who wants swags?)">Cherry on top (who wants swags?)</a></li><li><a href=#open-sesame aria-label="Open sesame">Open sesame</a></li></ul></li></ul></div></details></div><div class=post-content><p>For IaC, no doubt that Terraform is the leader. But there are other alternatives too, one of them is Pulumi. Currently Pulumi provides fun challenges to get started with their services. Best of all, they give you swags too! We are going to create a simple Pulumi project for hosting a static site through Cloudfront CDN.</p><p>Challenge url: <a href=https://www.pulumi.com/challenge/startup-in-a-box/>https://www.pulumi.com/challenge/startup-in-a-box/</a></p><h2 id=pre-requisites>Pre-requisites<a hidden class=anchor aria-hidden=true href=#pre-requisites>#</a></h2><ul><li><a href=https://app.pulumi.com/signup>Pulumi</a> account</li><li><a href=https://www.checklyhq.com/>Checkly</a> account</li><li>AWS acount</li><li>Install Pulumi cli: <code>brew install pulumi/tap/pulumi</code></li></ul><h2 id=steps>Steps<a hidden class=anchor aria-hidden=true href=#steps>#</a></h2><h3 id=init>Init<a hidden class=anchor aria-hidden=true href=#init>#</a></h3><p>Init pulumi project</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir pulumi-challenge-startup-in-a-box
</span></span><span style=display:flex><span>pulumi new aws-typescript
</span></span></code></pre></div><h3 id=create-s3-bucket>Create S3 bucket<a hidden class=anchor aria-hidden=true href=#create-s3-bucket>#</a></h3><p>Then we are going to create an s3 bucket to host static website, your <code>index.ts</code> should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>pulumi</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/pulumi&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>aws</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/aws&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>awsx</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/awsx&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bucket</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketV2</span>(<span style=color:#e6db74>&#34;bucketV2&#34;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;pulumi-challenge-karn-wong&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bucketAcl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketAclV2</span>(<span style=color:#e6db74>&#34;bAcl&#34;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bucket</span>: <span style=color:#66d9ef>bucket.id</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>acl</span>: <span style=color:#66d9ef>aws.s3.PublicReadAcl</span>,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=set-mime-type>Set MIME type<a hidden class=anchor aria-hidden=true href=#set-mime-type>#</a></h3><p>To set MIME type, we could leverage Node API:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install mime @types/mime
</span></span></code></pre></div><p>Then append this to <code>index.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>fs</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;fs&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>mime</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;mime&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>staticWebsiteDirectory</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;website&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readdirSync</span>(<span style=color:#a6e22e>staticWebsiteDirectory</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>file</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>filePath</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>staticWebsiteDirectory</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>file</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileContent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#a6e22e>filePath</span>).<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketObject</span>(<span style=color:#a6e22e>file</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bucket</span>: <span style=color:#66d9ef>bucket.id</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>asset</span>.<span style=color:#a6e22e>FileAsset</span>(<span style=color:#a6e22e>filePath</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>contentType</span>: <span style=color:#66d9ef>mime.getType</span>(<span style=color:#a6e22e>filePath</span>) <span style=color:#f92672>||</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>acl</span>: <span style=color:#66d9ef>aws.s3.PublicReadAcl</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=create-static-assets>Create static assets<a hidden class=anchor aria-hidden=true href=#create-static-assets>#</a></h3><p>But we are going to serve a static website, so we need to provide static assets:</p><h4 id=websiteindexhtml><code>website/index.html</code><a hidden class=anchor aria-hidden=true href=#websiteindexhtml>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Pulumi Challenge&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;style.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;normalize.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>header</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!-- The logo here is pulled from FontAwesome. Replace it with your own if you like! --&gt;</span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;logo&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>i</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fas fa-feather&#34;</span>&gt;&lt;/<span style=color:#f92672>i</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>p</span>&gt;Company Name&lt;/<span style=color:#f92672>p</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;social&#34;</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- Add your GitHub and social links here! --&gt;</span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://github.com/&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span>
</span></span><span style=display:flex><span>            &gt;&lt;<span style=color:#f92672>i</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fab fa-github-alt&#34;</span>&gt;&lt;/<span style=color:#f92672>i</span>
</span></span><span style=display:flex><span>          &gt;&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://twitter.com/&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span>
</span></span><span style=display:flex><span>            &gt;&lt;<span style=color:#f92672>i</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fab fa-twitter&#34;</span>&gt;&lt;/<span style=color:#f92672>i</span>
</span></span><span style=display:flex><span>          &gt;&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://linkedin.com/&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span>
</span></span><span style=display:flex><span>            &gt;&lt;<span style=color:#f92672>i</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fab fa-linkedin-in&#34;</span>&gt;&lt;/<span style=color:#f92672>i</span>
</span></span><span style=display:flex><span>          &gt;&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>li</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>ul</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>header</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;banner&#34;</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!-- Fill in the blanks for your startup&#39;s pitch! --&gt;</span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;Your Startup Name Here&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h3</span>&gt;Your Tagline&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>        We&#39;re $CompanyName, and we&#39;re changing what it means to $Task. Our
</span></span><span style=display:flex><span>        innovative use of $Technology makes life easier for $JobTitles, so they
</span></span><span style=display:flex><span>        can focus on what they&#39;re really good at instead of wasting time and
</span></span><span style=display:flex><span>        effort on $MenialOrDifficultTask. Streamline your $TaskProcess with
</span></span><span style=display:flex><span>        $Product and take to the skies!
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>script</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://kit.fontawesome.com/b4747495ea.js&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>crossorigin</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;anonymous&#34;</span>
</span></span><span style=display:flex><span>  &gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><h4 id=websitestylecss><code>website/style.css</code><a hidden class=anchor aria-hidden=true href=#websitestylecss>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span>@<span style=color:#66d9ef>import</span> <span style=color:#f92672>url</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://fonts.googleapis.com/css?family=News+Cycle|Teko&amp;display=swap&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>body</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: <span style=color:#ae81ff>#f7f7fa</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>opacity</span>: <span style=color:#ae81ff>0.8</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-image</span>: radial-gradient(<span style=color:#ae81ff>#f79645</span> <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>px</span>, <span style=color:#ae81ff>#f7f7fa</span> <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>px</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-size</span>: <span style=color:#ae81ff>10</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>10</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ul</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>list-style-type</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ul</span> <span style=color:#f92672>li</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>inline-block</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>a</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: <span style=color:#66d9ef>white</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-webkit-</span><span style=color:#66d9ef>transition</span>: <span style=color:#66d9ef>color</span> <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>ease-out</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>transition</span>: <span style=color:#66d9ef>color</span> <span style=color:#ae81ff>0.5</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>ease-out</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>text-decoration</span>: <span style=color:#66d9ef>none</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>a</span>:<span style=color:#a6e22e>hover</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span><span style=color:#f92672>a</span>:<span style=color:#a6e22e>active</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: rgb(<span style=color:#ae81ff>55</span>, <span style=color:#ae81ff>188</span>, <span style=color:#ae81ff>250</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>header</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: rgba(<span style=color:#ae81ff>214</span>, <span style=color:#ae81ff>73</span>, <span style=color:#ae81ff>73</span>, <span style=color:#ae81ff>0.6</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>height</span>: <span style=color:#ae81ff>80</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>position</span>: <span style=color:#66d9ef>absolute</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>top</span>: <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>100</span><span style=color:#66d9ef>%</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>box-shadow</span>: <span style=color:#ae81ff>0</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>7</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>-1</span><span style=color:#66d9ef>px</span> rgba(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.75</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-webkit-</span><span style=color:#66d9ef>box-shadow</span>: <span style=color:#ae81ff>0</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>7</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>-1</span><span style=color:#66d9ef>px</span> rgba(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.75</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-moz-</span><span style=color:#66d9ef>box-shadow</span>: <span style=color:#ae81ff>0</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>7</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>-1</span><span style=color:#66d9ef>px</span> rgba(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.75</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>header</span> <span style=color:#f92672>li</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: <span style=color:#66d9ef>white</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>active</span> <span style=color:#f92672>a</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: rgb(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>112</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>social</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>position</span>: <span style=color:#66d9ef>absolute</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>right</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>top</span>: <span style=color:#ae81ff>-5</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>30</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>social</span> <span style=color:#f92672>li</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>5</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>5</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>logo</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-family</span>: Teko;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>position</span>: <span style=color:#66d9ef>absolute</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>left</span>: <span style=color:#ae81ff>5</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>top</span>: <span style=color:#ae81ff>-60</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>40</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>banner</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>width</span>: <span style=color:#ae81ff>60</span><span style=color:#66d9ef>vw</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-family</span>: Teko;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>vw</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>center</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin-top</span>: <span style=color:#ae81ff>15</span><span style=color:#66d9ef>vw</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>margin-left</span>: <span style=color:#ae81ff>20</span><span style=color:#66d9ef>vw</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>banner</span> <span style=color:#f92672>h1</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: rgb(<span style=color:#ae81ff>214</span>, <span style=color:#ae81ff>73</span>, <span style=color:#ae81ff>73</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>banner</span> <span style=color:#f92672>p</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>about</span> <span style=color:#f92672>p</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>font-family</span>: News Cycle;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=websitenormalizecss><code>website/normalize.css</code><a hidden class=anchor aria-hidden=true href=#websitenormalizecss>#</a></h4><p>Download from <a href=https://github.com/necolas/normalize.css/blob/master/normalize.css>https://github.com/necolas/normalize.css/blob/master/normalize.css</a></p><h3 id=create-cloudfront-cdn>Create Cloudfront CDN<a hidden class=anchor aria-hidden=true href=#create-cloudfront-cdn>#</a></h3><p>We can always fetch the site via s3 directly, but your s3 bucket is in a single region. Users in far-away-regions might have a significant latency. To circumvent this, we could utilize CDN to reduce the site latency, since CDN would serve the content from a region nearest to users. To achieve this, append the following to <code>index.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>s3OriginId</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;myS3Origin&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cloudfrontDistribution</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>cloudfront</span>.<span style=color:#a6e22e>Distribution</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;s3Distribution&#34;</span>,
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>origins</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>domainName</span>: <span style=color:#66d9ef>bucket.bucketRegionalDomainName</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>originId</span>: <span style=color:#66d9ef>s3OriginId</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>enabled</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isIpv6Enabled</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>comment</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Some comment&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>defaultRootObject</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;index.html&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>defaultCacheBehavior</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>allowedMethods</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;DELETE&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;HEAD&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;OPTIONS&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;PATCH&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;PUT&#34;</span>,
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cachedMethods</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;HEAD&#34;</span>],
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>targetOriginId</span>: <span style=color:#66d9ef>s3OriginId</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>forwardedValues</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>queryString</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cookies</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>forward</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;none&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>viewerProtocolPolicy</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;allow-all&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>minTtl</span>: <span style=color:#66d9ef>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>defaultTtl</span>: <span style=color:#66d9ef>3600</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>maxTtl</span>: <span style=color:#66d9ef>86400</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>priceClass</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;PriceClass_200&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>restrictions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>geoRestriction</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>restrictionType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;whitelist&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>locations</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;US&#34;</span>, <span style=color:#e6db74>&#34;CA&#34;</span>, <span style=color:#e6db74>&#34;GB&#34;</span>, <span style=color:#e6db74>&#34;DE&#34;</span>],
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>viewerCertificate</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cloudfrontDefaultCertificate</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h3 id=reusable-module>Reusable module<a hidden class=anchor aria-hidden=true href=#reusable-module>#</a></h3><p>Think of it as instead of creating resources manually all the time, you can call a function instead. Refactor away we go!</p><ol><li>Remove cloudfront block in <code>index.ts</code></li><li>Create <code>cdn-website/index.ts</code> with following content:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>pulumi</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/pulumi&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>aws</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/aws&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>fs</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;fs&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>mime</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;mime&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This is a simpler verison of:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/pulumi/pulumi-aws-static-website
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CdnWebsite</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>ComponentResource</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bucket</span>: <span style=color:#66d9ef>aws.s3.BucketV2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>bucketAcl</span>: <span style=color:#66d9ef>aws.s3.BucketAclV2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>cloudfrontDistribution</span>: <span style=color:#66d9ef>aws.cloudfront.Distribution</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>s3OriginId</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;myS3Origin&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>staticWebsiteDirectory</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./website&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>any</span>, <span style=color:#a6e22e>opts?</span>: <span style=color:#66d9ef>pulumi.ComponentResourceOptions</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#e6db74>&#34;pulumi:challenge:CdnWebsite&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>args</span>, <span style=color:#a6e22e>opts</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bucket</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketV2</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;bucketV2&#34;</span>,
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tags</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;My bucket&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bucketAcl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketAclV2</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;bAcl&#34;</span>,
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>bucket</span>: <span style=color:#66d9ef>this.bucket.id</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>acl</span>: <span style=color:#66d9ef>aws.s3.PublicReadAcl</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cloudfrontDistribution</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>cloudfront</span>.<span style=color:#a6e22e>Distribution</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;s3Distribution&#34;</span>,
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>origins</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>domainName</span>: <span style=color:#66d9ef>this.bucket.bucketRegionalDomainName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>originId</span>: <span style=color:#66d9ef>this.s3OriginId</span>,
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>        ],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>enabled</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>isIpv6Enabled</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>comment</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Some comment&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>defaultRootObject</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;index.html&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>defaultCacheBehavior</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>allowedMethods</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;DELETE&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;HEAD&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;OPTIONS&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;PATCH&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;PUT&#34;</span>,
</span></span><span style=display:flex><span>          ],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>cachedMethods</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;HEAD&#34;</span>],
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>targetOriginId</span>: <span style=color:#66d9ef>this.s3OriginId</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>forwardedValues</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>queryString</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>cookies</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>forward</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;none&#34;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>viewerProtocolPolicy</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;allow-all&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>minTtl</span>: <span style=color:#66d9ef>0</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>defaultTtl</span>: <span style=color:#66d9ef>3600</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>maxTtl</span>: <span style=color:#66d9ef>86400</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>priceClass</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;PriceClass_200&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>restrictions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>geoRestriction</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>restrictionType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;whitelist&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>locations</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;US&#34;</span>, <span style=color:#e6db74>&#34;CA&#34;</span>, <span style=color:#e6db74>&#34;GB&#34;</span>, <span style=color:#e6db74>&#34;DE&#34;</span>],
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>viewerCertificate</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>cloudfrontDefaultCertificate</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this</span>,
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readdirSync</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>staticWebsiteDirectory</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>file</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>filePath</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>staticWebsiteDirectory</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>file</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileContent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#a6e22e>filePath</span>).<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>aws</span>.<span style=color:#a6e22e>s3</span>.<span style=color:#a6e22e>BucketObject</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>file</span>,
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>bucket</span>: <span style=color:#66d9ef>this.bucket.id</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>source</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>asset</span>.<span style=color:#a6e22e>FileAsset</span>(<span style=color:#a6e22e>filePath</span>),
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>contentType</span>: <span style=color:#66d9ef>mime.getType</span>(<span style=color:#a6e22e>filePath</span>) <span style=color:#f92672>||</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>acl</span>: <span style=color:#66d9ef>aws.s3.PublicReadAcl</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>this.bucket</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      );
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// We also need to register all the expected outputs for this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// component resource that will get returned by default.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>registerOutputs</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>bucketName</span>: <span style=color:#66d9ef>this.bucket.id</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cdnUrl</span>: <span style=color:#66d9ef>this.cloudfrontDistribution.domainName</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>url</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>Output</span>&lt;<span style=color:#f92672>string</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cloudfrontDistribution</span>.<span style=color:#a6e22e>domainName</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=3><li>In<code>index.ts</code> modify the file so that it looks like this:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Deploy Website to S3 with CloudFront
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Also shows the challenger how to build a ComponentResource
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CdnWebsite</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./cdn-website&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>website</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CdnWebsite</span>(<span style=color:#e6db74>&#34;your-startup&#34;</span>, {});
</span></span></code></pre></div><h3 id=sanity-checks>Sanity checks<a hidden class=anchor aria-hidden=true href=#sanity-checks>#</a></h3><p>If everything works correctly, we should be able to deploy the website. But it would be so much better if we can see whether the website is working normally or not. Status checks to the rescue!</p><p>Here we set up <code>checkly</code> provider:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install @checkly/pulumi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># API KEY: https://app.checklyhq.com/settings/account/api-keys</span>
</span></span><span style=display:flex><span>pulumi config set checkly:apiKey --secret
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># AccountID: https://app.checklyhq.com/settings/account/general</span>
</span></span><span style=display:flex><span>pulumi config set checkly:accountId
</span></span></code></pre></div><p>Then append this to <code>index.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>websiteUrl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>website</span>.<span style=color:#a6e22e>url</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>checkly</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@checkly/pulumi&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>fs</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;fs&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>checkly</span>.<span style=color:#a6e22e>Check</span>(<span style=color:#e6db74>&#34;index-page&#34;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>activated</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>frequency</span>: <span style=color:#66d9ef>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;BROWSER&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>locations</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;eu-west-2&#34;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>script</span>: <span style=color:#66d9ef>websiteUrl.apply</span>((<span style=color:#a6e22e>url</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#34;checkly-embed.js&#34;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>toString</span>(<span style=color:#e6db74>&#34;utf8&#34;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;{{websiteUrl}}&#34;</span>, <span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>  ),
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>But we need to supply logic for sanity checks, we can do this by creating <code>checkly-embed.js</code> (which the above checkly resource fetches).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>playwright</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>require</span>(<span style=color:#e6db74>&#34;playwright&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expect</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>require</span>(<span style=color:#e6db74>&#34;expect&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>browser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>playwright</span>.<span style=color:#a6e22e>chromium</span>.<span style=color:#a6e22e>launch</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>page</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>newPage</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#66d9ef>goto</span>(<span style=color:#e6db74>&#34;https://{{websiteUrl}}&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>expect</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>page</span>.<span style=color:#a6e22e>title</span>()).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#34;Pulumi Challenge&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>browser</span>.<span style=color:#a6e22e>close</span>();
</span></span></code></pre></div><h3 id=cherry-on-top-who-wants-swags>Cherry on top (who wants swags?)<a hidden class=anchor aria-hidden=true href=#cherry-on-top-who-wants-swags>#</a></h3><p>Kindly provided by folks at Pulumi, we can get cool swags by calling an API endpoint as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install got@11.8.0
</span></span></code></pre></div><p>Then paste the following in <code>swag-provider/index.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>pulumi</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@pulumi/pulumi&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>submittionUrl</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;https://hooks.airtable.com/workflows/v1/genericWebhook/apptZjyaJx5J2BVri/wflmg3riOP6fPjCII/wtr3RoDcz3mTizw3C&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SwagInputs</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;XS&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;S&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;M&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;L&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;XL&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;XXL&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;XXXL&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SwagCreateResponse</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>SwagOutputs</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>SwagInputs</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SwagProvider</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>dynamic</span>.<span style=color:#a6e22e>ResourceProvider</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>props</span>: <span style=color:#66d9ef>SwagInputs</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>pulumi.dynamic.CreateResult</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>got</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>await</span> <span style=color:#66d9ef>import</span>(<span style=color:#e6db74>&#34;got&#34;</span>)).<span style=color:#66d9ef>default</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>got</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>post</span>(<span style=color:#a6e22e>submittionUrl</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>json</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          ...<span style=color:#a6e22e>props</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>json</span>&lt;<span style=color:#f92672>SwagCreateResponse</span>&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>props.email</span>, <span style=color:#a6e22e>outs</span>: <span style=color:#66d9ef>props</span> };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Swag</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>pulumi</span>.<span style=color:#a6e22e>dynamic</span>.<span style=color:#a6e22e>Resource</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>props</span>: <span style=color:#66d9ef>SwagInputs</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>opts?</span>: <span style=color:#66d9ef>pulumi.CustomResourceOptions</span>
</span></span><span style=display:flex><span>  ) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SwagProvider</span>(<span style=color:#a6e22e>name</span>), <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>props</span>, <span style=color:#a6e22e>opts</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, paste this to <code>index.ts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Swag</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./swag-provider&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>swag</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Swag</span>(<span style=color:#e6db74>&#34;your-startup&#34;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;YOUR NAME&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;YOUR EMAIL&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;YOUR ADDRESS&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>size</span>: <span style=color:#66d9ef>SIZE</span>,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=open-sesame>Open sesame<a hidden class=anchor aria-hidden=true href=#open-sesame>#</a></h3><p>&lsquo;Nuff said</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pulumi up
</span></span></code></pre></div><p>If everything works correctly, your terminal should display something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Previewing update <span style=color:#f92672>(</span>dev<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/previews/xxxxxxxx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     Type                               Name                                   Plan
</span></span><span style=display:flex><span> +   pulumi:pulumi:Stack                pulumi-challenge-startup-in-a-box-dev  create
</span></span><span style=display:flex><span> +   â”œâ”€ pulumi:challenge:CdnWebsite     your-startup                           create
</span></span><span style=display:flex><span> +   â”‚  â”œâ”€ aws:s3:BucketV2              bucketV2                               create
</span></span><span style=display:flex><span> +   â”‚  â”‚  â”œâ”€ aws:s3:BucketObject       index.html                             create
</span></span><span style=display:flex><span> +   â”‚  â”‚  â”œâ”€ aws:s3:BucketObject       style.css                              create
</span></span><span style=display:flex><span> +   â”‚  â”‚  â””â”€ aws:s3:BucketObject       normalize.css                          create
</span></span><span style=display:flex><span> +   â”‚  â”œâ”€ aws:s3:BucketAclV2           bAcl                                   create
</span></span><span style=display:flex><span> +   â”‚  â””â”€ aws:cloudfront:Distribution  s3Distribution                         create
</span></span><span style=display:flex><span> +   â”œâ”€ pulumi-nodejs:dynamic:Resource  your-startup                           create
</span></span><span style=display:flex><span> +   â””â”€ checkly:index:Check             index-page                             create
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Outputs:
</span></span><span style=display:flex><span>    websiteUrl: output&lt;string&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Resources:
</span></span><span style=display:flex><span>    + <span style=color:#ae81ff>10</span> to create
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Do you want to perform this update? yes
</span></span><span style=display:flex><span>Updating <span style=color:#f92672>(</span>dev<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/updates/1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     Type                               Name                                   Status
</span></span><span style=display:flex><span> +   pulumi:pulumi:Stack                pulumi-challenge-startup-in-a-box-dev  created
</span></span><span style=display:flex><span> +   â”œâ”€ pulumi:challenge:CdnWebsite     your-startup                           created
</span></span><span style=display:flex><span> +   â”‚  â”œâ”€ aws:s3:BucketV2              bucketV2                               created
</span></span><span style=display:flex><span> +   â”‚  â”‚  â”œâ”€ aws:s3:BucketObject       style.css                              created
</span></span><span style=display:flex><span> +   â”‚  â”‚  â”œâ”€ aws:s3:BucketObject       index.html                             created
</span></span><span style=display:flex><span> +   â”‚  â”‚  â””â”€ aws:s3:BucketObject       normalize.css                          created
</span></span><span style=display:flex><span> +   â”‚  â”œâ”€ aws:cloudfront:Distribution  s3Distribution                         created
</span></span><span style=display:flex><span> +   â”‚  â””â”€ aws:s3:BucketAclV2           bAcl                                   created
</span></span><span style=display:flex><span> +   â”œâ”€ pulumi-nodejs:dynamic:Resource  your-startup                           created
</span></span><span style=display:flex><span> +   â””â”€ checkly:index:Check             index-page                             created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Outputs:
</span></span><span style=display:flex><span>    websiteUrl: <span style=color:#e6db74>&#34;dyacxs5ksi1r9.cloudfront.net&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Resources:
</span></span><span style=display:flex><span>    + <span style=color:#ae81ff>10</span> created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Duration: 3m25s
</span></span></code></pre></div><p>Don&rsquo;t you love it when everything works as you planned ðŸ˜Ž.</p><p><img loading=lazy src=/images/2022-09-26-15-30-32.png alt="checkly status checks"></p><p>To teardown all resources, run <code>pulumi destroy</code>. If successful, your terminal should return:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Previewing destroy <span style=color:#f92672>(</span>dev<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/previews/xxxxxxxx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     Type                               Name                                   Plan
</span></span><span style=display:flex><span> -   pulumi:pulumi:Stack                pulumi-challenge-startup-in-a-box-dev  delete
</span></span><span style=display:flex><span> -   â”œâ”€ checkly:index:Check             index-page                             delete
</span></span><span style=display:flex><span> -   â”œâ”€ pulumi-nodejs:dynamic:Resource  your-startup                           delete
</span></span><span style=display:flex><span> -   â””â”€ pulumi:challenge:CdnWebsite     your-startup                           delete
</span></span><span style=display:flex><span> -      â”œâ”€ aws:cloudfront:Distribution  s3Distribution                         delete
</span></span><span style=display:flex><span> -      â”œâ”€ aws:s3:BucketAclV2           bAcl                                   delete
</span></span><span style=display:flex><span> -      â””â”€ aws:s3:BucketV2              bucketV2                               delete
</span></span><span style=display:flex><span> -         â”œâ”€ aws:s3:BucketObject       normalize.css                          delete
</span></span><span style=display:flex><span> -         â”œâ”€ aws:s3:BucketObject       style.css                              delete
</span></span><span style=display:flex><span> -         â””â”€ aws:s3:BucketObject       index.html                             delete
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Outputs:
</span></span><span style=display:flex><span>  - websiteUrl: <span style=color:#e6db74>&#34;dyacxs5ksi1r9.cloudfront.net&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Resources:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10</span> to delete
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Do you want to perform this destroy? yes
</span></span><span style=display:flex><span>Destroying <span style=color:#f92672>(</span>dev<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>View Live: https://app.pulumi.com/kahnwong/pulumi-challenge-startup-in-a-box/dev/updates/2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     Type                               Name                                   Status
</span></span><span style=display:flex><span> -   pulumi:pulumi:Stack                pulumi-challenge-startup-in-a-box-dev  deleted
</span></span><span style=display:flex><span> -   â”œâ”€ checkly:index:Check             index-page                             deleted
</span></span><span style=display:flex><span> -   â”œâ”€ pulumi-nodejs:dynamic:Resource  your-startup                           deleted
</span></span><span style=display:flex><span> -   â””â”€ pulumi:challenge:CdnWebsite     your-startup                           deleted
</span></span><span style=display:flex><span> -      â”œâ”€ aws:cloudfront:Distribution  s3Distribution                         deleted
</span></span><span style=display:flex><span> -      â”œâ”€ aws:s3:BucketAclV2           bAcl                                   deleted
</span></span><span style=display:flex><span> -      â””â”€ aws:s3:BucketV2              bucketV2                               deleted
</span></span><span style=display:flex><span> -         â”œâ”€ aws:s3:BucketObject       index.html                             deleted
</span></span><span style=display:flex><span> -         â”œâ”€ aws:s3:BucketObject       normalize.css                          deleted
</span></span><span style=display:flex><span> -         â””â”€ aws:s3:BucketObject       style.css                              deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Outputs:
</span></span><span style=display:flex><span>  - websiteUrl: <span style=color:#e6db74>&#34;dyacxs5ksi1r9.cloudfront.net&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Resources:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10</span> deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Duration: 3m22s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The resources in the stack have been deleted, but the history and configuration associated with the stack are still maintained.
</span></span><span style=display:flex><span>If you want to remove the stack completely, run <span style=color:#e6db74>`</span>pulumi stack rm dev<span style=color:#e6db74>`</span>.
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.karnwong.me/tags/devops/>devops</a></li><li><a href=https://www.karnwong.me/tags/pulumi/>pulumi</a></li><li><a href=https://www.karnwong.me/tags/aws/>aws</a></li></ul><nav class=paginav><a class=prev href=https://www.karnwong.me/posts/2022/09/intro-to-dagster-cloud/><span class=title>Â« Prev</span><br><span>Intro to Dagster Cloud</span></a>
<a class=next href=https://www.karnwong.me/posts/2022/08/minimal-ecs-task-with-fargate-backend/><span class=title>Next Â»</span><br><span>Minimal ECS task with fargate backend</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.karnwong.me/>Karn Wong</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>