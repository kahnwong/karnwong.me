<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>IaC is cool, until someone specified the wrong machine size üí∏ | Karn Wong</title><meta name=keywords content="devops"><meta name=description content="Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn&rsquo;t before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.
It would almost be the end of the story, until someone realize &ldquo;oh my God how did I set up VPC peering with another VPC, and which route table did I choose?"><meta name=author content="Karn Wong"><link rel=canonical href=https://www.karnwong.me/posts/2022/11/iac-is-cool-until-someone-specified-the-wrong-machine-size/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.karnwong.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.karnwong.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.karnwong.me/favicon-32x32.png><link rel=apple-touch-icon href=https://www.karnwong.me/apple-touch-icon.png><link rel=mask-icon href=https://www.karnwong.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-8CYMFC0KZ9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8CYMFC0KZ9",{anonymize_ip:!1})}</script><meta property="og:title" content="IaC is cool, until someone specified the wrong machine size üí∏"><meta property="og:description" content="Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn&rsquo;t before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.
It would almost be the end of the story, until someone realize &ldquo;oh my God how did I set up VPC peering with another VPC, and which route table did I choose?"><meta property="og:type" content="article"><meta property="og:url" content="https://www.karnwong.me/posts/2022/11/iac-is-cool-until-someone-specified-the-wrong-machine-size/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-03T00:55:31+07:00"><meta property="article:modified_time" content="2022-11-03T00:55:31+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="IaC is cool, until someone specified the wrong machine size üí∏"><meta name=twitter:description content="Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn&rsquo;t before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.
It would almost be the end of the story, until someone realize &ldquo;oh my God how did I set up VPC peering with another VPC, and which route table did I choose?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.karnwong.me/posts/"},{"@type":"ListItem","position":2,"name":"IaC is cool, until someone specified the wrong machine size üí∏","item":"https://www.karnwong.me/posts/2022/11/iac-is-cool-until-someone-specified-the-wrong-machine-size/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"IaC is cool, until someone specified the wrong machine size üí∏","name":"IaC is cool, until someone specified the wrong machine size üí∏","description":"Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn\u0026rsquo;t before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.\nIt would almost be the end of the story, until someone realize \u0026ldquo;oh my God how did I set up VPC peering with another VPC, and which route table did I choose?","keywords":["devops"],"articleBody":"Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn‚Äôt before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.\nIt would almost be the end of the story, until someone realize ‚Äúoh my God how did I set up VPC peering with another VPC, and which route table did I choose? I need to replicate it with another client and I forgot how‚Äù. THe issue isn‚Äôt that working with the cloud‚Äôs web ui doesn‚Äôt work, rather it doesn‚Äôt leave a trail for you, so over time the knowledge of how things were set up are lost, gone forever. I‚Äôm sure you can always mitigate this by documenting things, but then it can happen that someone modified the infrastructure without updating the documentation. Can‚Äôt blame them, it‚Äôs only normal when you have to synchronize things manually.\nSo people came up with IaC - infrastructure as code. Basically this means, you write declarative blocks of what a resource‚Äôs configuration should be, and how it‚Äôs connected to another resources. Then you ‚Äúapply‚Äù the configuration on your cloud provider. If you are researching or want to get something up and running fast, I wouldn‚Äôt suggest you use IaC. But if you have to modify the configuration, you might find it easier to maintain in the long run, plus you can always use git diff to show the changes between each commit.\nAnd as how most things work, this certainly is not the end, because what if you have to create a new VM fleet, a small cluster for a research project. IaC can do this, but what if you were working late at night and you copied the wrong instance size into your IaC config - what could be 50 USD/month small cluster could turn out to be a 2000 USD / month large cluster, and it won‚Äôt even be utilized that much because your research workload is very light üí∏üí∏üí∏üí∏üí∏.\nLuckily humans excel at adaptation, so we came up with ‚ÄúIaC policy‚Äù, where you can define a set of constraints that your resources should comply to. This could be anything from ‚Äúonly instance smaller than $x is allowed‚Äù, or ‚Äútotal monthly cost most not exceed $y‚Äù. It can also be ‚Äúmaximum storage allowed is 500GB‚Äù, or even ‚Äúdaily backup is required for $z resource‚Äù. The world is not that gloomy, a lot of people made sure of that üöÄ.\nAnd I know you are eager to get your hands on at policy as code thing, so head to a pulumi challenge and take a stab at it!\n","wordCount":"471","inLanguage":"en","datePublished":"2022-11-03T00:55:31+07:00","dateModified":"2022-11-03T00:55:31+07:00","author":{"@type":"Person","name":"Karn Wong"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.karnwong.me/posts/2022/11/iac-is-cool-until-someone-specified-the-wrong-machine-size/"},"publisher":{"@type":"Organization","name":"Karn Wong","logo":{"@type":"ImageObject","url":"https://www.karnwong.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.karnwong.me/ accesskey=h title="Karn Wong (Alt + H)">Karn Wong</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.karnwong.me/about/ title=About><span>About</span></a></li><li><a href=https://www.karnwong.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://www.karnwong.me/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.karnwong.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.karnwong.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.karnwong.me/>Home</a>&nbsp;¬ª&nbsp;<a href=https://www.karnwong.me/posts/>Posts</a></div><h1 class=post-title>IaC is cool, until someone specified the wrong machine size üí∏</h1><div class=post-meta><span title='2022-11-03 00:55:31 +0700 +07'>November 3, 2022</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Karn Wong</div></header><div class=post-content><p>Back in the day, there was no cloud. If you want a lot of computing power, you need to build your own data center, and this is very expensive. Then cloud happened, and suddenly you can work with a lot of flexibility like you couldn&rsquo;t before. Want to try out a small deployment? Sure! If your workload is heavier you can always increase the VM specs.</p><p>It would almost be the end of the story, until someone realize &ldquo;oh my God how did I set up VPC peering with another VPC, and which route table did I choose? I need to replicate it with another client and I forgot how&rdquo;. THe issue isn&rsquo;t that working with the cloud&rsquo;s web ui doesn&rsquo;t work, rather it doesn&rsquo;t leave a trail for you, so over time the knowledge of how things were set up are lost, gone forever. I&rsquo;m sure you can always mitigate this by documenting things, but then it can happen that someone modified the infrastructure <em>without</em> updating the documentation. Can&rsquo;t blame them, it&rsquo;s only normal when you have to synchronize things manually.</p><p>So people came up with IaC - infrastructure as code. Basically this means, you write declarative blocks of what a resource&rsquo;s configuration should be, and how it&rsquo;s connected to another resources. Then you &ldquo;apply&rdquo; the configuration on your cloud provider. If you are researching or want to get something up and running fast, I wouldn&rsquo;t suggest you use IaC. But if you have to modify the configuration, you might find it easier to maintain in the long run, plus you can always use <code>git diff</code> to show the changes between each commit.</p><p>And as how most things work, this certainly is not the end, because what if you have to create a new VM fleet, a small cluster for a research project. IaC can do this, but what if you were working late at night and you copied the wrong instance size into your IaC config - what could be 50 USD/month small cluster could turn out to be a 2000 USD / month large cluster, and it won&rsquo;t even be utilized that much because your research workload is very light üí∏üí∏üí∏üí∏üí∏.</p><p>Luckily humans excel at adaptation, so we came up with &ldquo;IaC policy&rdquo;, where you can define a set of constraints that your resources should comply to. This could be anything from &ldquo;only instance smaller than $x is allowed&rdquo;, or &ldquo;total monthly cost most not exceed $y&rdquo;. It can also be &ldquo;maximum storage allowed is 500GB&rdquo;, or even &ldquo;daily backup is required for $z resource&rdquo;. The world is not that gloomy, a lot of people made sure of that üöÄ.</p><p>And I know you are eager to get your hands on at policy as code thing, so head to <a href=https://www.pulumi.com/challenge/one-quickstart/>a pulumi challenge</a> and take a stab at it!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.karnwong.me/tags/devops/>devops</a></li></ul><nav class=paginav><a class=prev href=https://www.karnwong.me/posts/2022/11/deploy-more-efficiently-with-templating/><span class=title>¬´ Prev</span><br><span>Deploy more efficiently with templating</span></a>
<a class=next href=https://www.karnwong.me/posts/2022/10/deploy-static-site-with-branch-preview-via-cloudflare-pages/><span class=title>Next ¬ª</span><br><span>Deploy static site with branch preview via Cloudflare Pages</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.karnwong.me/>Karn Wong</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>